/**
https://twitter.com/yukifuyuki
https://www.twitch.tv/yukifuyuki
*/
"use strict";let o=[],c=[],l=0,t,r,n=0;function buttonClick(){var e=f(document.getElementById("fcid").value);!1===e?p("Invalid FC URL or ID"):a(e)}function a(e){C(),p("Fetching FC "+e);let n=r=Date.now();fetch(`https://xivapi.com/freecompany/${e}?data=FCM`,{mode:"cors"}).then(e=>e.json()).then(e=>{console.log(e),n===r&&(void 0===e.FreeCompany?p("Could not find FC. Please double check URL or ID."):(p(`Found FC ${e.FreeCompany.Name} on `+e.FreeCompany.Server),null==(t=e).FreeCompanyMembers?p('<b style="color:red">Error reading FC members, please refresh the page and try again. This happens sometimes for large FCs.</b>'):i(e.FreeCompanyMembers,n)))}).catch(e=>console.log(e))}function i(t,r){l=t.length,p(`Fetching FC members data for ${t.length} members. This can take up to ${Math.round(1.1*t.length)} seconds.`);for(var a=0;a<t.length;a++){let e=t[a].ID,n=r;o.push(setTimeout(()=>d(e,n),50*(a+1)))}}function d(t,r){fetch("https://xivapi.com/character/"+t).then(e=>{if(n++,e.ok)return e.json();throw new Error("Need more time to fetch player")}).then(e=>u(e,r)).catch(e=>{var n=h();console.log(`Waiting ${n/1e3} seconds for player id `+t),o.push(setTimeout(()=>d(t,r),n))})}function h(){return 50*Math.max(0,l-n)+1e3*(Math.max(0,o.length-l)-Math.max(0,n-l))}function u(e,n){n===r&&0!==l&&(0<c.length&&y(),c.push(e),p(`Checked ${c.length} members out of ${l} total. ETA ${Math.round(1.1*(l-c.length))} seconds.`),c.length===l&&m())}function m(){var n=0,e=(c.forEach(e=>{4===e.Character.Race&&2===e.Character.Gender&&n++}),`${t.FreeCompany.Name} FC on ${t.FreeCompany.Server} has ${n} catgirls. This is ${Math.round(1e3*n/c.length)/10}% of the ${c.length} members.`),e=(p(`<b>${e}</b>`),`https://twitter.com/intent/tweet?url=https%3A%2F%2Fyukifuyuki.github.io%2Ffc-catgirls%2F&text=${encodeURIComponent(e)}&hashtags=FFXIV`);p(`<a href="${e}" target="_blank">Share on Twitter</a>`),document.getElementById("advancedToggle").style.display="",filterAdvanced()}function filterAdvanced(){var n=parseInt(document.querySelector('input[name="gender"]:checked').value),t=parseInt(document.querySelector('input[name="race"]:checked').value),r=0,a=document.getElementById("advOutput");a.innerHTML='<hr><p id="advSummary"></p><p>',c.forEach(e=>{0!==t&&e.Character.Race!==t||0!==n&&e.Character.Gender!==n||(r++,a.innerHTML+=e.Character.Name+"<br>")}),a.innerHTML+="</p>",document.getElementById("advSummary").innerHTML=`<b>${r} (${Math.round(1e3*r/c.length)/10}%) are ${e(n,t)}.</b>`}function e(e,n){return 2===e&&4===n?"catgirls":s(e)+" "+g(n)}function s(e){return 2===e?"female":0===e?"any gender":1===e?"male":void 0}function g(e){return 4===e?"Miqo'te":0===e?"any race":1===e?"Hyur":2===e?"Elezen":3===e?"Lalafell":5===e?"Roegadyn":6===e?"Au Ra":7===e?"Hrothgar":8===e?"Viera":void 0}function f(e){var n;return e.match(/^\d+$/)||(n=e.indexOf("any/"),0<(n=(e=e.substring(n+"any/".length)).indexOf("/"))&&(e=e.substring(0,n))),!!e.match(/^\d+$/)&&e}function p(e){document.getElementById("log").innerHTML+=`<p>${e}</p>`}function y(){var e,n=document.getElementById("log");n.hasChildNodes()&&(e=n.childNodes,n.removeChild(e[e.length-1]))}function v(){document.getElementById("log").innerHTML=""}function C(){v(),c=[],l=0,t=null,r=null,document.getElementById("advancedToggle").style.display="none",F=!0,toggleAdvanced();for(var e=0;e<o.length;e++)clearTimeout(o[e]);o=[]}var F=!1;function toggleAdvanced(){F=!F,document.getElementById("advanced").style.display=F?"":"none"}